<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ recipe.recipe_name }} - Recipe Details</title>
    
    <!-- Add any additional styling if needed -->
    <style>
        /* Add styling for the todo list */
        #toggleTodoBtn {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }

        #todoList {
            display: none;
            margin-top: 20px;
        }

        #todoList label {
            display: block;
            margin-bottom: 10px;
        }

        .completed {
            text-decoration: line-through;
        }
    </style>
</head>
<body>
    <h1>{{ recipe.recipe_name }}</h1>
    <img src="{{ url_for('static', filename='images/recipeimages/' + recipe.recipe_image) }}" alt="{{ recipe.recipe_name }}" style="max-width: 450px; height: 450px;">
    
    <h2>Ingredients:</h2>
    <h3>{{ recipe.recipe_ingredients }}</h3>

    <h2>Details:</h2>
    <p id="recipeDetails">{{ recipe.recipe_details }}</p>

    <!-- Download button -->
    <button id="downloadBtn">Download Recipe as PDF</button>

    <!-- Todo list button and container -->
    <button id="toggleTodoBtn">Toggle Todo List</button>
    <div id="todoList"></div>

    <!-- Add any additional information you want to display -->

    <a href="{{ url_for('recipe_search') }}" id="backToSearch">Back to Recipe Search</a>

    <!-- Add latest jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script>
        
    var recipeData = {
        recipe_name: {{ recipe.recipe_name | tojson | safe }},
        recipe_image: "{{ url_for('static', filename='images/recipeimages/' + recipe.recipe_image) }}",
        recipe_ingredients: {{ recipe.recipe_ingredients | tojson | safe }},
        recipe_details: {{ recipe.recipe_details | tojson | safe }}
    };
</script>

    </script>
    <script>
        window.jsPDF = window.jspdf.jsPDF;

        document.getElementById('downloadBtn').addEventListener('click', function () {
            downloadRecipe(recipeData);
        });

        function downloadRecipe(recipe) {
            // Create a new jsPDF instance
            var pdf = new jsPDF();

            // Add recipe name, image, ingredients, and details to the PDF
            pdf.text(recipe.recipe_name, 70, 20);  // Centered horizontally
            pdf.addImage(recipe.recipe_image, 'JPEG', 20, 40, 80, 80);
            pdf.text('Ingredients:', 20, 220);
            pdf.text(recipe.recipe_ingredients, 20, 230);
            pdf.text('Details:', 20, 260);
            pdf.text(recipe.recipe_details, 20, 270);


            // Save the PDF
            pdf.save(`${recipe.recipe_name}.pdf`);
        }

        document.getElementById('toggleTodoBtn').addEventListener('click', () => {
            var todoList = document.getElementById('todoList');
            // Toggle visibility of the todo list
            todoList.style.display = todoList.style.display === 'none' ? 'block' : 'none';

            // Create todo list dynamically from recipe details
            if (todoList.style.display === 'block') {
                createTodoList();
            }
        });

        function createTodoList() {
            var recipeDetails = document.getElementById('recipeDetails').innerText;
            var todoListContainer = document.getElementById('todoList');
            todoListContainer.innerHTML = '';

            // Split recipe details into todo items based on full stops
            var todoItems = recipeDetails.split('.').filter(Boolean);

            // Create checkboxes for each todo item
            todoItems.forEach((item, index) => {
                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = 'todoItem' + index;

                var label = document.createElement('label');
                label.htmlFor = 'todoItem' + index;
                label.appendChild(document.createTextNode(item.trim()));

                // Check if the item is marked as completed
                if (localStorage.getItem('todoItem' + index) === 'completed') {
                    checkbox.checked = true;
                    label.classList.add('completed');
                }

                var br = document.createElement('br');

                // Add event listener to handle checkbox state changes
                checkbox.addEventListener('change', function () {
                    if (this.checked) {
                        label.classList.add('completed');
                        localStorage.setItem(this.id, 'completed');
                    } else {
                        label.classList.remove('completed');
                        localStorage.removeItem(this.id);
                    }
                });

                todoListContainer.appendChild(checkbox);
                todoListContainer.appendChild(label);
                todoListContainer.appendChild(br);
            });
        }
    </script>
</body>
</html>
